/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Tree=function(){function n(t,e){_classCallCheck(this,n),this.dom=scope(t),this.dom.addClass("tree"),this.data=_.cloneDeep(e.data);if(0!=e.data.length){var a=[];!function e(a,n,c){return c.filter(function(t){return t.pid===a}).forEach(function(t){t.children=e(t.id,[],c),n.push(t)}),n}(0,a,e.data);!function n(t){_.each(t,function(t){var e=t.children.length;if(0==e)return!0;var a=_.filter(t.children,["checked",!0]).length;0<a&&a<e&&(t.half=!0),n(t.children)})}(a),e.data=a,this.param=$.extend({data:[],checkbox:!1,open:!1,oncheck:null,onclick:null},e),this.run()}else this.dom.html('<span class="note mt20">没有树形菜单数据</span>')}return _createClass(n,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var o=this,r={html:"",key:0};!function h(l,t){var e=2<arguments.length&&void 0!==arguments[2]&&arguments[2],d=3<arguments.length&&void 0!==arguments[3]&&arguments[3];0<l&&(r.html+="<div",!0===e||o.param.open||(r.html+=' class="dn"'),r.html+=">"),_.each(t,function(t){var e="",a=0,n=t.children.length;if(0==l?(0==n&&(e=' style="margin-left:0;"'),(o.param.open||!0===t.open)&&(a=1)):((!0===t.open||o.param.open)&&(a=1),o.param.checkbox&&(e+=' class="tree-checkbox"'),0==n&&(e+=' style="padding-left:'+(o.param.checkbox?46:38)+'px;"')),r.html+="<ul"+e+"><li>",0<n){var c=1==a?"rotate-90":"rotate-0";r.html+='<i data-open="'+a+'" class="ri-arrow-right-s-line '+c+'"></i>'}if(o.param.checkbox){var i="";!0===t.checked&&(i+=" checked"),!0!==t.disabled&&!0!==d||(i+=" disabled"),!0===t.half&&(i+=' class="checkbox-half"'),r.html+='<label>\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid="'+t.id+'" \n\t\t\t\t\t\t\t\t\t\tdata-pid="'+t.pid+'" \n\t\t\t\t\t\t\t\t\t\tdata-key="'+r.key+'" \n\t\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\t\t'+i+"> "+t.name+"\n\t\t\t\t\t\t\t\t</label>"}else r.html+='<span \n\t\t\t\t\t\t\t\t\tdata-nav="'+r.key+'" \n\t\t\t\t\t\t\t\t\t'+(o.param.checkbox?"":' class="cp"')+">"+t.name+"\n\t\t\t\t\t\t\t\t</span>";r.key++,0<n&&(!0===d&&(t.disabled=d),h(l+1,t.children,t.open,t.disabled)),r.html+="</li></ul>"}),0<l&&(r.html+="</div>")}(0,this.param.data),this.dom.html(r.html)}},{key:"_event",value:function(){var t=["[data-open]",":checkbox","[data-nav]"],i=this;i.dom.on("click",t[0],function(){var t={this:$(this)};if(t.open=t.this.data("open"),t.child=t.this.next().next(),0==t.open)return t.this.data("open",1).removeClass("rotate-0").addClass("rotate-90"),void t.child.slideDown(200);t.this.data("open",0).removeClass("rotate-90").addClass("rotate-0"),t.child.slideUp(200)}).on("click",t[1],function(){var a={this:$(this)},c={checkChild:function(t){var e=i.dom.find('input[data-pid="'+t+'"]:not(:disabled)');0!=e.length&&(Form.checkbox(e,a.check),e.each(function(){c.checkChild($(this).attr("id"))}))},checkParent:function(t){var e=i.dom.find("#"+t);if(0!=e.length){var a=i.dom.find('input[data-pid="'+t+'"]').length,n=i.dom.find('input[data-pid="'+t+'"]:not(.checkbox-half):checked').length;if(a==n)Form.checkbox(e,!0);else if(0==n){0<i.dom.find('.checkbox-half[data-pid="'+t+'"]:checked').length?Form.checkbox(e,!0,!0):Form.checkbox(e,!1)}else Form.checkbox(e,!0,!0);e.each(function(){c.checkParent($(this).data("pid"))})}}};if(a.check=a.this.is(":checked"),a.pid=a.this.data("pid"),a.id=a.this.attr("id"),a.key=a.this.data("key"),c.checkChild(a.id),c.checkParent(a.pid),null!=i.param.oncheck){a.checked=i.dom.find(":checked");var n=[];a.checked.each(function(){var t=$(this),e=i.data[t.data("key")];e.half=!!t.hasClass("checkbox-half"),n.push(e)}),i.param.oncheck(i.data[a.key],n)}}),i.param.checkbox||null==i.param.onclick||i.dom.on("click",t[2],function(){var t={this:$(this)};t.key=t.this.data("nav"),i.param.onclick(i.data[t.key])})}}]),n}();