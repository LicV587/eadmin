/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Page=function(){function n(t){if(_classCallCheck(this,n),null!=t.data){this.window=null!=Mount.window?"#"+Mount.window:null,null!=t.search&&(this.searchBox=null!=this.window?this.window+" "+t.search.boxid:t.search.boxid,this.searchBoxCache=$(this.searchBox)),null!=t.page&&(this.pageBox=null!=this.window?this.window+" "+t.page.boxid:t.page.boxid,this.pageBoxCache=$(this.pageBox)),this.storeKey=md5(Eadmin.currentHref),this.page=1;var e=store(this.storeKey+"_page");null!=e&&(this.page=parseInt(e)),this.size=10,this.pageCount=null,this.get={},this.param=t;var a=store(this.storeKey+"_size");null!=a&&(this.param.page.size=parseInt(a)),this.size=this.param.page.size,this.get[this.param.page.page_field]=this.page,this.get[this.param.page.size_field]=this.size,this.init=!1,this.run()}else console.log("自定义分页必须指定数据接口")}return _createClass(n,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var e=this,n=this,t=function(){if(null!=e.param.page){var t='<div class="table-page">\n\t\t\t\t\t\t\t\t<span class="info">\n\t\t\t\t\t\t\t\t\t共<em></em>条，每页\n\t\t\t\t\t\t\t\t\t<select name="pagesize" data-width="70">\n\t\t\t\t\t\t\t\t\t\t<option value="10"'+(10==e.size?" selected":"")+'>10</option>\n\t\t\t\t\t\t\t\t\t\t<option value="30"'+(30==e.size?" selected":"")+'>30</option>\n\t\t\t\t\t\t\t\t\t\t<option value="50"'+(50==e.size?" selected":"")+'>50</option>\n\t\t\t\t\t\t\t\t\t\t<option value="100"'+(100==e.size?" selected":"")+">100</option>\n\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t条，\n\t\t\t\t\t\t\t\t\t当前 <em>"+e.page+'</em>/<em>-</em> 页\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="prev-page"><i class="ri-arrow-left-s-line"></i></span>\n\t\t\t\t\t\t\t\t<span class="next-page"><i class="ri-arrow-right-s-line"></i></span>\n\t\t\t\t\t\t\t\t<span class="jump">\n\t\t\t\t\t\t\t\t\t跳转到第\n\t\t\t\t\t\t\t\t\t<input name="page" type="text" placeholder="页数">\n\t\t\t\t\t\t\t\t\t页\n\t\t\t\t\t\t\t\t\t<button class="highlight small">确定</button>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>';e.pageBoxCache.html(t)}};(function(){if(null!=e.param.search){var a='<div class="table-search">\n\t\t\t\t\t\t\t\t<form>\n\t\t\t\t\t\t\t\t\t<div class="block-box">';_.each(e.param.search.field,function(t,e){switch(a+='<div class="col-3">\n\t\t\t\t\t\t\t\t<div class="form-group">',t.type){case"input":a+='<div class="input-group">\n\t\t\t\t\t\t\t\t\t\t<span class="prepend">'+t.name+'</span>\n\t\t\t\t\t\t\t\t\t\t<input name="'+e+'" type="text" \n\t\t\t\t\t\t\t\t\t\t\tplaceholder="请输入'+t.name+'">\n\t\t\t\t\t\t\t\t\t</div>';break;case"datepicker":a+='<div class="input-group">\n\t\t\t\t\t\t\t\t\t\t<span class="prepend">'+t.name+'</span>\n\t\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\t\tid="table-datepicker-'+e+'" \n\t\t\t\t\t\t\t\t\t\t\tclass="table-datepicker"\n\t\t\t\t\t\t\t\t\t\t\tname="'+e+'" \n\t\t\t\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\t\t\t\tplaceholder="请选择'+t.name+'">\n\t\t\t\t\t\t\t\t\t</div>';break;case"citypicker":a+='<div class="input-group">\n\t\t\t\t\t\t\t\t\t\t<span class="prepend">'+t.name+'</span>\n\t\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\t\tid="table-citypicker-'+e+'" \n\t\t\t\t\t\t\t\t\t\t\tclass="table-citypicker"\n\t\t\t\t\t\t\t\t\t\t\tname="'+e+'" \n\t\t\t\t\t\t\t\t\t\t\ttype="text" \n\t\t\t\t\t\t\t\t\t\t\tplaceholder="请选择'+t.name+'">\n\t\t\t\t\t\t\t\t\t</div>';break;case"select":a+='<select name="'+e+'" data-width="100%">\n\t\t\t\t\t\t\t\t\t\t<option value="'+module.conf.select_default_val+'">\n\t\t\t\t\t\t\t\t\t\t\t请选择'+t.name+"\n\t\t\t\t\t\t\t\t\t\t</option>",_.each(t.option,function(t){a+='<option value="'+t.val+'">\n\t\t\t\t\t\t\t\t\t\t\t'+t.key+"\n\t\t\t\t\t\t\t\t\t\t</option>"}),a+="</select>"}a+="</div></div>"}),a+='<div class="col-3">\n\t\t\t\t\t\t\t<button class="search-do highlight">\n\t\t\t\t\t\t\t\t<i class="ri-search-line"></i>搜索\n\t\t\t\t\t\t\t</button><button class="search-refresh">\n\t\t\t\t\t\t\t\t<i class="ri-refresh-line"></i>重置\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div></form></div>',e.searchBoxCache.prepend(a),e.searchBoxCache.find(".table-datepicker").each(function(){var t=$(this),e=t.attr("name"),a={};null!=n.param.search.field[e].param&&(a=n.param.search.field[e].param),Eadmin.datepicker("#"+t.attr("id"),a)}),e.searchBoxCache.find(".table-citypicker").each(function(){var t=$(this),e=t.attr("name"),a={};null!=n.param.search.field[e].param&&(a=n.param.search.field[e].param),Eadmin.citypicker("#"+t.attr("id"),a)})}})(),t(),this._loadData()}},{key:"_event",value:function(){var t=[".search-do",".search-refresh",".table-page select",".table-page .num-page:not(.current)",".table-page .prev-page",".table-page .next-page",".table-page button"],a=this,e=function(t){Eadmin.message.error({content:t}),a.pageBox.find("input").val("")};null!=a.param.search&&a.searchBoxCache.on("click",t[0],function(){a.page=1,a.get[a.param.page.page_field]=a.page;var t=a.searchBoxCache.find("form").serialize(),e=_.split(t,"&");return _.each(e,function(t){var e=_.split(t,"=");a.get[e[0]]=e[1]}),a._loadData(!0),!1}).on("click",t[1],function(){return a.searchBoxCache.find("input").val(""),Form.select(a.searchBoxCache),!1}),null!=a.param.page&&a.pageBoxCache.on("change",t[2],function(){a.page=1,a.size=parseInt($(this).val()),store(a.storeKey+"_page",a.page.toString()),store(a.storeKey+"_size",a.size.toString()),a.get[a.param.page.page_field]=a.page,a.get[a.param.page.size_field]=a.size,a._loadData(!0)}).on("click",t[3],function(){a.page=parseInt($(this).html()),store(a.storeKey+"_page",a.page.toString()),a.get[a.param.page.page_field]=a.page,a._loadData(!0)}).on("click",t[4],function(){1!=a.page&&(a.page-=1,store(a.storeKey+"_page",a.page.toString()),a.get[a.param.page.page_field]=a.page,a._loadData(!0))}).on("click",t[5],function(){a.page!=a.pageCount&&(a.page+=1,store(a.storeKey+"_page",a.page.toString()),a.get[a.param.page.page_field]=a.page,a._loadData(!0))}).on("click",t[6],function(){var t=a.pageBoxCache.find("input").val();""!=t?t<1?e("跳转的页数不能小于1"):t>a.pageCount?e("跳转的页数已经超出了最大页数"):t!=a.page?(store(a.storeKey+"_page",t),a.page=parseInt(t),a.get[a.param.page.page_field]=a.page,a._loadData(!0)):e("已经在待跳转的页面了"):e("跳转的页数不能为空")})}},{key:"_page",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(null!=this.param.page)if(_.has(t,"count")){null!=this.window?$(this.window+" .body")[0].scrollTop=0:box[0].scrollTop=0,this.init||this.pageBoxCache.data("size",this.size);var a={count:this.pageBoxCache.find("em:first"),page:this.pageBoxCache.find("em").eq(1),pageCount:this.pageBoxCache.find("em").eq(2)};t.count==parseInt(a.count.html())&&this.size==this.pageBoxCache.data("size")||(t.count<this.size?this.pageCount=1:t.count%this.size==0?this.pageCount=t.count/this.size:this.pageCount=parseInt(t.count/this.size)+1,a.count.html(t.count),a.pageCount.html(this.pageCount),this.size!=this.pageBoxCache.data("size")&&this.pageBoxCache.data("size",this.size)),a.page.html(this.page);var n=10;_.has(this.param.page,"num")&&((n=this.param.page.num)<3&&(n=3),10<n&&(n=10));var i="",s=this.page,p=n+((s-=_.floor(n/2))<1?(s=1,0):this.page-_.floor(n/2)-1);p>this.pageCount&&(p=this.pageCount),p-s<n-1&&(s-=n-(p-s)-1),s<1&&(s=1);for(var o=s;o<=p;o++)i+='<span class="num-page'+(o==this.page?" current":"")+'" data-page="'+o+'">'+o+"</span>";this.pageBoxCache.find(".num-page").remove(),this.pageBoxCache.find(".prev-page").after(i),this.init&&e&&Eadmin.message.success({content:"当前第 "+this.page+" 页，共 "+this.pageCount+" 页"})}else console.log("数据源中未包含数据总条数count字段，创建分页失败")}},{key:"_loadData",value:function(){var a=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];axios.get(this.param.data,{params:this.get}).then(function(t){var e={data:t.data};null!=e.data.count||null==a.param.page?null!=e.data.list?(Eadmin.template(a.param.tmp,e.data),a._page(e.data,n),a.init=!0):console.log("数据源中没有包含list字段"):console.log("返回的数据源中没有 count 字段，无法使用分页")}).catch(function(t){console.log(t)})}}]),n}();